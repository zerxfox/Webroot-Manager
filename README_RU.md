# Webroot Manager

**Webroot Manager** –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ `webroot` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –º–æ–¥—É–ª—è–º–∏.

---

## üöÄ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Android 10+**
- **Magisk, Apatch –∏–ª–∏ KSU**
- **–¢–µ—Ä–º–∏–Ω–∞–ª** (–Ω–∞–ø—Ä–∏–º–µ—Ä, Termux)

---

## üèÅ –ó–∞–ø—É—Å–∫ Webroot Manager

1. **–ß–µ—Ä–µ–∑ action button** (–¥–æ—Å—Ç—É–ø–Ω–æ —Å Magisk v28.0).
2. **–í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:** –æ—Ç–∫—Ä–æ–π—Ç–µ `localhost:8080`.

---

## üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Webroot Manager

–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
su -c webroot
```

---

## üìç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞

–ß—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –¥—Ä—É–≥–∏–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º, –æ–±–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ Wi-Fi —Å–µ—Ç–∏.

–î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

- –ó–∞–π–¥–∏—Ç–µ –≤ –º–µ–Ω—é –º–æ–¥—É–ª—è –Ω–∞ –≤—Ç–æ—Ä–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
- –ï—Å–ª–∏ Wi-Fi —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ, –≤—ã —É–≤–∏–¥–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ IP:–ø–æ—Ä—Ç.
- –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –ø–æ—è–≤–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ".
- –í –∏–Ω–æ–º —Å–ª—É—á–∞–µ, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Wi-Fi —Å–µ—Ç–∏ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–¥—É–ª—å, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π IP.

---

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

### ‚ùì –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `localhost:8080`

**–û—Ç–≤–µ—Ç:** –í–≤–µ–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
```bash
su -c webroot
```

### ‚ùì Webroot Manager –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–û—Ç–≤–µ—Ç:** –≠—Ç–∞ –æ—à–∏–±–∫–∞ –Ω–µ —Å–≤—è–∑–∞–Ω–∞ —Å Webroot Manager. –û–Ω –ª–∏—à—å –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç `html` –º–æ–¥—É–ª—è –∏ –µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –µ–¥–∏–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥—É–ª–µ–π –º–æ–≥—É—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –º–æ–¥—É–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Webroot Manager –≤ –±—É–¥—É—â–µ–º.

---

## üìú –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å:

[![Changelog](https://img.shields.io/badge/üìú-Changelog-blue)](changelog_ru.md)

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

Webroot Manager –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª—è:

```
module/
‚îú‚îÄ‚îÄ webroot/
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ oresty.conf
‚îÇ   ‚îî‚îÄ‚îÄ module_icon.png
‚îú‚îÄ‚îÄ service.sh
‚îî‚îÄ‚îÄ customize.sh
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:
- –ü–∞–ø–∫–∞ `webroot` –∏ —Ñ–∞–π–ª `index.html` ‚Äî **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã**.
- `module_icon.png` ‚Äî –∏–∫–æ–Ω–∫–∞ –≤–∞—à–µ–≥–æ –º–æ–¥—É–ª—è. –ï—Å–ª–∏ –µ—ë –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è.
- `oresty.conf` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞—à–µ–≥–æ –º–æ–¥—É–ª—è. –ü–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –ø—Ä–∏ –µ—ë –Ω–∞–ª–∏—á–∏–∏.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –§–∞–π–ª `index.html` –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –ø–æ–∑–∂–µ, –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤–∞—à–µ–≥–æ –º–æ–¥—É–ª—è.

---

### üìë –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—É—Ç—è–º –∫ —Ñ–∞–π–ª–∞–º

–ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ **css**, **js**, **php**, **sh** –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ `html`, –Ω–∞—á–∞–ª—å–Ω—ã–π —Å–ª—ç—à `/` –≤ `href` –∏–ª–∏ `src` —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ Webroot Manager –Ω–µ —Å–º–æ–∂–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Ñ–∞–π–ª—ã.

#### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã:
```html
<img src="files/icon.png">
<link href="styles.css">
```

#### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã:
```html
<img src="/files/icon.png">
<link href="/styles.css">
```

---

## üåê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è OpenResty (`oresty.conf`)

–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –æ–±—ä—è—Å–Ω—è—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ OpenResty –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–æ–≤ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `.sh` —Å–∫—Ä–∏–ø—Ç–æ–≤ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

### üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è .sh —Å–∫—Ä–∏–ø—Ç–æ–≤

–≠—Ç–æ—Ç –±–ª–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å `.sh` —Å–∫—Ä–∏–ø—Ç—ã —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –°–∫—Ä–∏–ø—Ç—ã –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/data/adb/modules/$module_name/webroot/`, –≥–¥–µ `$module_name` ‚Äî —ç—Ç–æ –∏–º—è –ø–∞–ø–∫–∏ –≤–∞—à–µ–≥–æ –º–æ–¥—É–ª—è.

```nginx
location ~* /$module_name/webroot/.*\.sh$ {
    root /data/adb/modules;
    default_type text/plain;
    content_by_lua_block {
        local pipe = require("ngx.pipe")
        local uri = ngx.var.uri
        local script_path = ngx.var.document_root .. uri

        local file = io.open(script_path, "r")
        if not file then
            ngx.status = 404
            ngx.say("Error: script not found")
            return
        end
        file:close()

        local args_str = ngx.var.query_string or ""
        local args_table = {}
        for arg in string.gmatch(args_str, "[^&]+") do
            table.insert(args_table, arg)
        end

        local command = {"sh", script_path}
        for _, v in ipairs(args_table) do
            table.insert(command, v)
        end

        local proc, err = pipe.spawn(command, { stdout = true, stderr = true })
        if not proc then
            ngx.status = 500
            ngx.say("Error: failed to execute script - ", err)
            return
        end

        proc:set_timeouts(300000, 3600000, 3600000, 86400000)

        ngx.header["Content-Type"] = "text/plain"
        ngx.flush(true)

        while true do
            local line, err = proc:stdout_read_line()
            if not line then
                break
            end
            ngx.say(line)
            ngx.flush(true)
        end

        proc:wait()
    }
}
```

### üìú –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–æ–≥–æ–≤

–≠—Ç–æ—Ç –±–ª–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ª–æ–≥–∞–º –º–æ–¥—É–ª—è, –Ω–∞—Ö–æ–¥—è—â–∏–º—Å—è –ø–æ –ø—É—Ç–∏ `/data/adb/modules/$module_name/webroot/script_logs.out`, –≥–¥–µ `$module_name` ‚Äî –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –≤–∞—à–µ–≥–æ –º–æ–¥—É–ª—è.

```nginx
location $module_name/logs {
    content_by_lua_block {
        local file_path = "/data/adb/modules/$module_name/webroot/script_logs.out"
        local offset = tonumber(ngx.var.arg_offset) or 0

        local file, err = io.open(file_path, "rb")
        if not file then
            ngx.status = 500
            ngx.say("Error opening log: ", err)
            return
        end

        local ok, seek_err = file:seek("set", offset)
        if not ok then
            ngx.status = 500
            ngx.say("Error seeking log: ", seek_err)
            file:close()
            return
        end

        local data = file:read("*a")
        local new_offset = file:seek("cur")
        file:close()

        if not data or #data == 0 then
            ngx.status = 204
            return
        end

        ngx.header["Content-Type"] = "text/plain"
        ngx.header["X-Log-Offset"] = tostring(new_offset)
        ngx.print(data)
    }
}
```
